{% load i18n %}
{% load Pleio_templatetags %}

<h2>{% block title %}{% trans "Two-factor authentication" %}{% endblock %}</h2>
<div class="account__cards ui cards" style="margin:0 -.5em">

    {% if 2FA.state == 'default' %}
        {% if 2FA.default_device %}
        <div class="card">
            <div class="card ___nopadding content">
                <h3 class="card__title ___addpadding-side header">{% trans "Backup tokens" %}</h3>
                <p class="___addpadding-side">
                    {% trans "Tokens will be generated by your token generator." %}<br /><br />
                    {% blocktrans %}If you don't have any device with you, you can access
                    your account using backup tokens.{% endblocktrans %}
                    {% blocktrans count counter=2FA.backup_tokens %}
                    You have only one backup token remaining.
                    {% plural %}
                    You have {{ counter }} backup tokens remaining.
                    {% endblocktrans %}
                </p>
            </div>
            <div class="card__action ___addpadding-side extra content">
                <a href="{% url 'security_pages' page_action='2fa-showcodes' %}" class="button ___clear ui button right floated primary">{% trans "Show codes" %}</a>
            </div>
        </div>
        {% endif %}
    {% endif %}

    {% if 2FA.state == 'setup' %}

        <form method="post" action="/securitypages/2fa-setupnext/" class="ui form">
            <div class="account__cards ui card">
                  <div class="content">
          		      <h3 class="card__title ___addpadding-side header">{% trans "Enable two-factor authentication" %}</h3>
                    {% csrf_token %}

                    <fieldset class="___addpadding-side">
                        <p>{% blocktrans %}Scan the QR-code below with your token generator and enter the generated token.{% endblocktrans %}</p>
                        <p>
                            <center>
                                <img src="{{ 2FA.QR_URL }}" alt="QR Code" />
                            </center>
                        </p>
                        <br />
                        <div class="field">
                            {{ 2FA.form.errors.token }}
                            {{ 2FA.form.token.label_tag }}
                            {{ 2FA.form.token }}
                        </div>

                        <p class="textcolor_secondary">
                            {% blocktrans %}Don't have a token generator? Try <a href="https://support.google.com/accounts/answer/1066447" target="_blank" rel="nofollow">Google Authenticator</a> or <a href="https://authy.com/download/" target="_blank" rel="nofollow">Authy</a>.{% endblocktrans %}
                        </p>
                    </fieldset>

                  </div>
                <div class="card__action ___addpadding-side extra content">
                    <button name="2fa-setupnext" type="submit" class="button  ___active ___clear login__login ui button right floated">{% trans "Next" %}</button>
                </div>
            </div>
        </form>

    {% endif %}

    {% if 2FA.state == 'codes' %}
    <form method="post" class="ui form" action="." "page_action=2fa-generatecodes">{% csrf_token %}{{ form }}
        <div class="account__cards ui card">
            <div class="___nopadding content">
              <h3 class="card__title ___addpadding-side header">{% trans "Backup tokens" %}</h3>


                <div class="___addpadding-side">
                    <p>{% blocktrans %}Backup tokens can be used when your primary and backup
                        phone numbers aren't available. The backup tokens below can be used
                        for login verification. If you've used up all your backup tokens, you
                        can generate a new set of backup tokens. Only the backup tokens shown
                        below will be valid.{% endblocktrans %}</p>
                        {% if 2FA.tokens.count %}
                        <ul class="horizontal list">
                            {% for token in 2FA.tokens %}
                            <li>
                                <span class="badge  ui label">{{ token.token }}</span>
                            </li>
                            {% endfor %}
                        </ul>
                        <p>{% blocktrans %}Print these tokens and keep them somewhere safe.{% endblocktrans %}</p>
                        {% else %}
                        <p>{% trans "You don't have any backup codes yet." %}</p>
                        {% endif %}
                    </div>

                </div>
                <div class="card__action ___addpadding-side extra content">
                    <button name="2fa-generatecodes" type="submit" class="button ___clear ui button right floated primary">{% trans "Generate tokens" %}</button>
                </div>
        </div>
      </form>
    {% endif %}

    {% if 2FA.state == 'disable' %}

        <form method="post" action="/securitypages/2fa-disableconfirm/" class="ui form">
          <div class="account__cards ui card">
              <div class=" ___nopadding content">
                    {% csrf_token %}
                    <h3 class="card__title ___addpadding-side header">{% trans "Disable two-factor authentication" %}</h3>
                    <fieldset class="___addpadding-side">
                        <p>{% blocktrans %}You are about to disable two-factor authentication. This
                        compromises your account security, are you sure?{% endblocktrans %}</p>
                        <div class="login__check field">
			                        <div class="ui checkbox">
                                <input id="id_understand" name="understand" type="checkbox" required="">
                                <label for="id_understand">{% trans "Yes, I am sure" %}</label>
                              </div>
                        </div>
                    </fieldset>
              </div>
              <div class="card__action ___addpadding-side extra content">
                  <button name="2fa-disableconfirm" type="submit" class="button ___clear ui button right floated negative">{% trans "Disable" %}</button>
              </div>
          </div>
        </form>

    {% endif %}

    {% if 2FA.show_state %}
        <div class="card">

            {% if 2FA.default_device %}
            <div class="___nopadding content">
                <h3 class="card__title ___addpadding-side header">{% trans "Disable two-factor authentication" %}</h3>
                <div class="___addpadding-side">
                    <div class="image__2fa __disable">
                        {% include_asset "images/2fa.svg" %}
                    </div>
                    {% blocktrans %}However we strongly discourage you to do so, you can
                    also disable two-factor authentication for your account.{% endblocktrans %}
                </div>
              </div>
                <div class="card__action ___addpadding-side extra content">
                    <a href="{% url 'security_pages' page_action='2fa-disable' %}" class="button ___clear ui button negative right floated">{% trans "Disable" %}</a>
                </div>
            {% else %}
            <div class="___nopadding content">
                <h3 class="card__title ___addpadding-side header">{% trans "Enable Two-Factor Authentication" %}</h3>
                <div class="___addpadding-side">
                    <div class="image__2fa __enable">
                        {% include_asset "images/2fa.svg" %}
                    </div>
                    {% blocktrans %}Two-factor authentication is not enabled for your
                        account. Enable two-factor authentication for enhanced account
                        security.{% endblocktrans %}
                </div>
              </div>
              <div class="extra content">
                <form method="post" action="/securitypages/2fa-setup/">
                    <div class="card__action ___addpadding-side">
                        {% csrf_token %}
                        <button name="2fa-setup" type="submit" class="ui button right floated primary">{% trans "Enable" %}</button>
                    </div>
                </form>
            </div>
            {% endif %}
      </div>
    {% endif %}
</div>
